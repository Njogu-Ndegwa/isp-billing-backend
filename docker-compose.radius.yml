# RADIUS Server Configuration for ISP Billing
# =============================================
# This is a SEPARATE docker-compose file for RADIUS functionality.
# It extends the main docker-compose.yml without modifying it.
#
# Usage:
#   docker-compose -f docker-compose.yml -f docker-compose.radius.yml up -d
#
# This will start your existing services PLUS the FreeRADIUS server.

services:
  # FreeRADIUS server for hotspot authentication
  freeradius:
    image: freeradius/freeradius-server:3.2.3
    container_name: isp_billing_radius
    ports:
      - "1812:1812/udp"   # RADIUS Authentication
      - "1813:1813/udp"   # RADIUS Accounting
      # Note: CoA (Change of Authorization) is sent FROM this server TO the router
      # on port 3799, so no inbound CoA port is needed here.
    volumes:
      - ./radius/clients.conf:/etc/raddb/clients.conf:ro
      - ./radius/mods-enabled/sql:/etc/raddb/mods-enabled/sql:ro
      - ./radius/mods-available/sql:/etc/raddb/mods-available/sql:ro
      - ./radius/sites-enabled/default:/etc/raddb/sites-enabled/default:ro
      - ./radius/dictionary.mikrotik:/etc/raddb/dictionary.mikrotik:ro
      - ./radius/dictionary:/etc/raddb/dictionary:ro
    environment:
      # Database connection for RADIUS
      - RADIUS_DB_HOST=db
      - RADIUS_DB_PORT=5432
      - RADIUS_DB_NAME=isp_billing_db
      - RADIUS_DB_USER=isp_user
      - RADIUS_DB_PASS=isp_secure_pass_2024
    depends_on:
      db:
        condition: service_healthy
    networks:
      - isp-network
    restart: unless-stopped
    # Run in debug mode initially - remove -X for production
    command: ["radiusd", "-f", "-l", "stdout"]

volumes:
  postgres_data:

networks:
  isp-network:
    driver: bridge
